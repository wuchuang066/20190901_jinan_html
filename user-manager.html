<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>XXXX 商城后台管理系统</title>
    <!-- 导入图标 -->
    <link href="img/favicon1.ico" rel="icon">
    <!-- Vendor styles -->
    <link rel="stylesheet"
          href="vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css">
    <link rel="stylesheet" href="vendors/bower_components/animate.css/animate.min.css">
    <link rel="stylesheet" href="vendors/bower_components/jquery.scrollbar/jquery.scrollbar.css">
    <link rel="stylesheet" href="vendors/bower_components/fullcalendar/dist/fullcalendar.min.css">
    <link rel="stylesheet" href="vendors/bower_components/select2/dist/css/select2.min.css">

    <!-- App styles -->
    <link rel="stylesheet" href="css/app.min.css">
</head>

<body data-sa-theme="1">
<main class="main">
    <div class="page-loader">
        <div class="page-loader__spinner">
            <svg viewBox="25 25 50 50">
                <circle cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/>
            </svg>
        </div>
    </div>
    <!-- 页面顶部开始 -->
    <header class="header">

    </header>
    <!-- 页面顶部结束 -->
    <!-- 页面左侧代码 start -->
    <aside class="sidebar">

    </aside>
    <!-- 页面左侧 end -->
    <!-- 右侧内容开始 -->
    <section class="content">
        <nav aria-label="breadcrumb" role="navigation">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">用户管理</a></li>
                <!-- <li class="breadcrumb-item active" aria-current="page">Library</li> -->
            </ol>
        </nav>
        <div class="card">
            <div class="card-body">
                <!-- 查询 -->
                <div class="row">
                    <div class="col-lg-3">
                        <input type="text" id="userName" class="form-control" placeholder="请输入要查询的用户名..."
                               autocomplete="off">
                    </div>
                    <div class="col-lg-3">
                        <select class="select2" id="userSex">
                            <option value="-1">请选择性别</option>
                            <option value="0">男</option>
                            <option value="1">女</option>
                        </select>
                    </div>
                    <div class="col-lg-3">
                        <input type="text" id="userAddress" class="form-control" placeholder="请输入收货地址...">
                    </div>
                    <div class="col-lg-3">
                        <button class="btn btn-light btn--icon-text" id="searchBtn"><i class="zmdi zmdi-search"></i>
                            Search
                        </button>
                    </div>
                </div>
                <hr>
                <!-- 结果开始 -->
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th style="width: 8%;">序号</th>
                        <th style="width: 10%;">姓名</th>
                        <th style="width: 15%;">联系电话</th>
                        <th style="width: 10%;">状态</th>
                        <th>收货地址</th>
                    </tr>
                    </thead>
                    <tbody id="userTbody">
                    <!-- <tr>
                        <td>01</td>
                        <td><a href="#" class="showUserModal" data-toggle="modal" data-target="#userMsgModal">vecher</a></td>
                        <td>13800000130</td>
                        <td>
                            <div class="toggle-switch">
                                <input type="checkbox" class="toggle-switch__checkbox">
                                <i class="toggle-switch__helper"></i>
                            </div>
                        </td>
                        <td>北京市海淀区中关村</td>
                    </tr> -->
                    </tbody>
                </table>
                <!-- 分页按钮 -->
                <nav >
                    <ul class="pagination justify-content-center" id="userPage" >
                        <!-- <li class="page-item pagination-prev"><a class="page-link" href="#"></a></li>
                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">4</a></li>
                        <li class="page-item"><a class="page-link" href="#">5</a></li>
                        <li class="page-item"><a class="page-link" href="#">6</a></li>
                        <li class="page-item pagination-next"><a class="page-link" href="#"></a></li> -->
                    </ul>
                </nav>
                <!-- 结果结束 -->
            </div>
        </div>
    </section>
    <!-- 右侧内容结束 -->

</main>
<!-- 模态框 start -->
<div class="modal fade" id="userMsgModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- 模态框顶部 -->
            <div class="modal-header">
                <h5 class="modal-title pull-left">User Message</h5>
            </div>
            <!-- 模态框中间部分 -->
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-3 text-center ">用 户 姓 名:</div>
                    <div class="col-lg-7 modalName"><span>XXXXX</span></div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col-lg-3 text-center">用 户 性 别:</div>
                    <div class="col-lg-7 modalSex"><span>男</span></div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col-lg-3 text-center">用 户 邮 箱:</div>
                    <div class="col-lg-7 modalEmail"><span>213465434@qq.com</span></div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col-lg-3 text-center">收 货 地 址:</div>
                    <div class="col-lg-7 modalAddress"><span>北京市海淀区中关村软件园266栋楼</span></div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col-lg-3 text-center">注 册 时 间:</div>
                    <div class="col-lg-7 modalDate"><span>2019-09-05 08:08:08</span></div>
                </div>
            </div>

            <!-- 模态框底部 -->
            <div class="modal-footer">
                <button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- 模态框 end -->
<!-- Javascript -->
<!-- Vendors -->
<!-- 漂亮弹框 开始 -->
<script src="js/sweetalert.min.js"></script>
<!-- 漂亮弹框 结束 -->
<!-- 导入分页js -->
<script src="js/pageButtons.js"></script>
<script src="js/jquery-1.10.2.js"></script>
<script src="vendors/bower_components/popper.js/dist/umd/popper.min.js"></script>
<script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="vendors/bower_components/jquery.scrollbar/jquery.scrollbar.min.js"></script>
<script src="vendors/bower_components/jquery-scrollLock/jquery-scrollLock.min.js"></script>

<script src="vendors/bower_components/salvattore/dist/salvattore.min.js"></script>
<script src="vendors/bower_components/flot/jquery.flot.js"></script>
<script src="vendors/bower_components/flot/jquery.flot.resize.js"></script>
<script src="vendors/bower_components/flot.curvedlines/curvedLines.js"></script>
<script src="vendors/bower_components/jqvmap/dist/jquery.vmap.min.js"></script>
<script src="vendors/bower_components/jqvmap/dist/maps/jquery.vmap.world.js"></script>
<script src="vendors/bower_components/jquery.easy-pie-chart/dist/jquery.easypiechart.min.js"></script>
<script src="vendors/bower_components/peity/jquery.peity.min.js"></script>
<script src="vendors/bower_components/moment/min/moment.min.js"></script>
<script src="vendors/bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
<script src="vendors/bower_components/select2/dist/js/select2.full.min.js"></script>

<!-- Charts and maps-->
<script src="demo/js/flot-charts/curved-line.js"></script>
<script src="demo/js/flot-charts/line.js"></script>
<!-- <script src="demo/js/flot-charts/dynamic.js"></script> -->
<script src="demo/js/flot-charts/chart-tooltips.js"></script>
<script src="demo/js/other-charts.js"></script>
<script src="demo/js/jqvmap.js"></script>

<!-- App functions and actions -->
<script src="js/app.min.js"></script>
<script src="js/url.js"></script>
<!-- 自己写的js代码 -->
<script type="text/javascript">
    // 当页面加载完毕之后，自动触发查询事件
    window.onload = () => {
        $('#searchBtn').trigger("click");
    }
    // 加载页面头部内容
    $(".header").load("head.html");
    // 设置激活菜单
    window.sessionStorage.removeItem("menu");
    window.sessionStorage.removeItem("sub-menu");
    window.sessionStorage.setItem("menu", "user-menu");
    // 加载页面左侧内容
    $(".sidebar").load("left.html");
    $(function () {
        let tempPageNumber = 1;
        $("#searchBtn").click(() => {
            // 查询指定页数的用户信息
            selectUsers(tempPageNumber);
        })

        function selectUsers(pageNumber) {
            tempPageNumber = pageNumber;
            // 获得分页元素
            const userPageBody = $("#userPage");
            const userTbody = $("#userTbody");
            // 移除tr
            userTbody.find('tr').remove();
            const data = {
                userName: $("#userName").val(),
                userSex: $("#userSex").val(),
                userAddress: $("#userAddress").val()
            };
            const url = userMsgQueryUrl + pageNumber;
            $.post(url, data, (result) => {
                console.log(result);
                if (result.code == 0) {
                    const userData = result.resultData.users;
                    const users = userData.list;
                    for (let [index, user] of users.entries()) {
                        const tr = $(`<tr></tr>`);
                        tr.append(`<td>${parseInt(userData.startRow + index)}</td>`);
                        tr.append(
                            `<td ><a href=${JSON.stringify(user)} class="showUserModal" data-toggle="modal" data-target="#userMsgModal">${user.userName}</a></td>`
                        );
                        tr.append(`<td>${user.userPhone}</td>`);
                        tr.append($(`<td>` + (user.userState == 1 ?
                                `<div class="toggle-switch"><input name = "${users[index].userName}" href="${users[index].userId}" title = "${users[index].userState}" type="checkbox" class="toggle-switch__checkbox" checked><i class="toggle-switch__helper"></i></div>` :
                                `<div class="toggle-switch"><input name = "${users[index].userName}" href="${users[index].userId}" title = "${users[index].userState}" type="checkbox" class="toggle-switch__checkbox"><i class="toggle-switch__helper"></i></div>`
                        ) + `</td>`));
                        tr.append(`<td>${user.userAddress}</td>`);
                        userTbody.append(tr);
                    }
                    // 修改用户状态
                    $(".toggle-switch__checkbox").on('click', function () {
                        const userName = $(this).attr('name');
                        swal({
                            title: "😊",
                            text: `确定要修改${userName}的状态么?`,
                            icon: "warning",
                            buttons: ["取消", "确定"],
                            dangerMode: false,
                        }).then((willUdate) => {
                            if (willUdate) {
                                const userId = $(this).attr("href");
                                let userState = $(this).attr("title");
                                userState = (userState == 1 ? 2 : 1);
                                const data = {
                                    userId,
                                    userState
                                }
                                console.log(data);
                                $.post(userMsgUpdateUrl, data);
                            } else {
                                swal(`😊`, `${userName}的状态未修改`).then(() => {
                                    selectUsers(tempPageNumber);
                                });
                            }
                        })

                    });
                    // 点击用户名字触发单击事件
                    $(".showUserModal").on('click', function () {
                        // 获得JSON形式字符串 转换成JSON
                        const jsonUser = JSON.parse($(this).attr('href'));
                        $(".modalName").text(jsonUser.userName);
                        $(".modalSex").text((jsonUser.userSex == 0 ? "♂" : "♀"));
                        $(".modalEmail").text(jsonUser.userEmail);
                        $(".modalAddress").text(jsonUser.userAddress);
                        $(".modalDate").text(new Date(jsonUser.userDate).toLocaleString());
                    });
                    const pageData = result.resultData.users;
                    // 在页面中添加分页按钮
                    showPageButton(userPageBody, pageData, selectUsers);
                } else {
                    const tr = $(`<tr><td colspan="5">没有查询到满足条件的信息！</td></tr>`);
                    userTbody.append(tr);
                }
            })
        }

    });
</script>
<script type="text/javascript">

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>XXXX å•†åŸåå°ç®¡ç†ç³»ç»Ÿ</title>
    <!-- å¯¼å…¥å›¾æ ‡ -->
    <link href="img/favicon1.ico" rel="icon">
    <!-- Vendor styles -->
    <link rel="stylesheet"
          href="vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css">
    <link rel="stylesheet" href="vendors/bower_components/animate.css/animate.min.css">
    <link rel="stylesheet" href="vendors/bower_components/jquery.scrollbar/jquery.scrollbar.css">
    <link rel="stylesheet" href="vendors/bower_components/fullcalendar/dist/fullcalendar.min.css">
    <link rel="stylesheet" href="vendors/bower_components/select2/dist/css/select2.min.css">

    <!-- App styles -->
    <link rel="stylesheet" href="css/app.min.css">
</head>

<body data-sa-theme="1">
<main class="main">
    <div class="page-loader">
        <div class="page-loader__spinner">
            <svg viewBox="25 25 50 50">
                <circle cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/>
            </svg>
        </div>
    </div>
    <!-- é¡µé¢é¡¶éƒ¨å¼€å§‹ -->
    <header class="header">

    </header>
    <!-- é¡µé¢é¡¶éƒ¨ç»“æŸ -->
    <!-- é¡µé¢å·¦ä¾§ä»£ç  start -->
    <aside class="sidebar">

    </aside>
    <!-- é¡µé¢å·¦ä¾§ end -->
    <!-- å³ä¾§å†…å®¹å¼€å§‹ -->
    <section class="content">
        <nav aria-label="breadcrumb" role="navigation">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">ç”¨æˆ·ç®¡ç†</a></li>
                <!-- <li class="breadcrumb-item active" aria-current="page">Library</li> -->
            </ol>
        </nav>
        <div class="card">
            <div class="card-body">
                <!-- æŸ¥è¯¢ -->
                <div class="row">
                    <div class="col-lg-3">
                        <input type="text" id="userName" class="form-control" placeholder="è¯·è¾“å…¥è¦æŸ¥è¯¢çš„ç”¨æˆ·å..."
                               autocomplete="off">
                    </div>
                    <div class="col-lg-3">
                        <select class="select2" id="userSex">
                            <option value="-1">è¯·é€‰æ‹©æ€§åˆ«</option>
                            <option value="0">ç”·</option>
                            <option value="1">å¥³</option>
                        </select>
                    </div>
                    <div class="col-lg-3">
                        <input type="text" id="userAddress" class="form-control" placeholder="è¯·è¾“å…¥æ”¶è´§åœ°å€...">
                    </div>
                    <div class="col-lg-3">
                        <button class="btn btn-light btn--icon-text" id="searchBtn"><i class="zmdi zmdi-search"></i>
                            Search
                        </button>
                    </div>
                </div>
                <hr>
                <!-- ç»“æœå¼€å§‹ -->
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th style="width: 8%;">åºå·</th>
                        <th style="width: 10%;">å§“å</th>
                        <th style="width: 15%;">è”ç³»ç”µè¯</th>
                        <th style="width: 10%;">çŠ¶æ€</th>
                        <th>æ”¶è´§åœ°å€</th>
                    </tr>
                    </thead>
                    <tbody id="userTbody">
                    <!-- <tr>
                        <td>01</td>
                        <td><a href="#" class="showUserModal" data-toggle="modal" data-target="#userMsgModal">vecher</a></td>
                        <td>13800000130</td>
                        <td>
                            <div class="toggle-switch">
                                <input type="checkbox" class="toggle-switch__checkbox">
                                <i class="toggle-switch__helper"></i>
                            </div>
                        </td>
                        <td>åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘</td>
                    </tr> -->
                    </tbody>
                </table>
                <!-- åˆ†é¡µæŒ‰é’® -->
                <nav >
                    <ul class="pagination justify-content-center" id="userPage" >
                        <!-- <li class="page-item pagination-prev"><a class="page-link" href="#"></a></li>
                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">4</a></li>
                        <li class="page-item"><a class="page-link" href="#">5</a></li>
                        <li class="page-item"><a class="page-link" href="#">6</a></li>
                        <li class="page-item pagination-next"><a class="page-link" href="#"></a></li> -->
                    </ul>
                </nav>
                <!-- ç»“æœç»“æŸ -->
            </div>
        </div>
    </section>
    <!-- å³ä¾§å†…å®¹ç»“æŸ -->

</main>
<!-- æ¨¡æ€æ¡† start -->
<div class="modal fade" id="userMsgModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- æ¨¡æ€æ¡†é¡¶éƒ¨ -->
            <div class="modal-header">
                <h5 class="modal-title pull-left">User Message</h5>
            </div>
            <!-- æ¨¡æ€æ¡†ä¸­é—´éƒ¨åˆ† -->
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-3 text-center ">ç”¨ æˆ· å§“ å:</div>
                    <div class="col-lg-7 modalName"><span>XXXXX</span></div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col-lg-3 text-center">ç”¨ æˆ· æ€§ åˆ«:</div>
                    <div class="col-lg-7 modalSex"><span>ç”·</span></div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col-lg-3 text-center">ç”¨ æˆ· é‚® ç®±:</div>
                    <div class="col-lg-7 modalEmail"><span>213465434@qq.com</span></div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col-lg-3 text-center">æ”¶ è´§ åœ° å€:</div>
                    <div class="col-lg-7 modalAddress"><span>åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘è½¯ä»¶å›­266æ ‹æ¥¼</span></div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col-lg-3 text-center">æ³¨ å†Œ æ—¶ é—´:</div>
                    <div class="col-lg-7 modalDate"><span>2019-09-05 08:08:08</span></div>
                </div>
            </div>

            <!-- æ¨¡æ€æ¡†åº•éƒ¨ -->
            <div class="modal-footer">
                <button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- æ¨¡æ€æ¡† end -->
<!-- Javascript -->
<!-- Vendors -->
<!-- æ¼‚äº®å¼¹æ¡† å¼€å§‹ -->
<script src="js/sweetalert.min.js"></script>
<!-- æ¼‚äº®å¼¹æ¡† ç»“æŸ -->
<!-- å¯¼å…¥åˆ†é¡µjs -->
<script src="js/pageButtons.js"></script>
<script src="js/jquery-1.10.2.js"></script>
<script src="vendors/bower_components/popper.js/dist/umd/popper.min.js"></script>
<script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="vendors/bower_components/jquery.scrollbar/jquery.scrollbar.min.js"></script>
<script src="vendors/bower_components/jquery-scrollLock/jquery-scrollLock.min.js"></script>

<script src="vendors/bower_components/salvattore/dist/salvattore.min.js"></script>
<script src="vendors/bower_components/flot/jquery.flot.js"></script>
<script src="vendors/bower_components/flot/jquery.flot.resize.js"></script>
<script src="vendors/bower_components/flot.curvedlines/curvedLines.js"></script>
<script src="vendors/bower_components/jqvmap/dist/jquery.vmap.min.js"></script>
<script src="vendors/bower_components/jqvmap/dist/maps/jquery.vmap.world.js"></script>
<script src="vendors/bower_components/jquery.easy-pie-chart/dist/jquery.easypiechart.min.js"></script>
<script src="vendors/bower_components/peity/jquery.peity.min.js"></script>
<script src="vendors/bower_components/moment/min/moment.min.js"></script>
<script src="vendors/bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
<script src="vendors/bower_components/select2/dist/js/select2.full.min.js"></script>

<!-- Charts and maps-->
<script src="demo/js/flot-charts/curved-line.js"></script>
<script src="demo/js/flot-charts/line.js"></script>
<!-- <script src="demo/js/flot-charts/dynamic.js"></script> -->
<script src="demo/js/flot-charts/chart-tooltips.js"></script>
<script src="demo/js/other-charts.js"></script>
<script src="demo/js/jqvmap.js"></script>

<!-- App functions and actions -->
<script src="js/app.min.js"></script>
<script src="js/url.js"></script>
<!-- è‡ªå·±å†™çš„jsä»£ç  -->
<script type="text/javascript">
    // å½“é¡µé¢åŠ è½½å®Œæ¯•ä¹‹åï¼Œè‡ªåŠ¨è§¦å‘æŸ¥è¯¢äº‹ä»¶
    window.onload = () => {
        $('#searchBtn').trigger("click");
    }
    // åŠ è½½é¡µé¢å¤´éƒ¨å†…å®¹
    $(".header").load("head.html");
    // è®¾ç½®æ¿€æ´»èœå•
    window.sessionStorage.removeItem("menu");
    window.sessionStorage.removeItem("sub-menu");
    window.sessionStorage.setItem("menu", "user-menu");
    // åŠ è½½é¡µé¢å·¦ä¾§å†…å®¹
    $(".sidebar").load("left.html");
    $(function () {
        let tempPageNumber = 1;
        $("#searchBtn").click(() => {
            // æŸ¥è¯¢æŒ‡å®šé¡µæ•°çš„ç”¨æˆ·ä¿¡æ¯
            selectUsers(tempPageNumber);
        })

        function selectUsers(pageNumber) {
            tempPageNumber = pageNumber;
            // è·å¾—åˆ†é¡µå…ƒç´ 
            const userPageBody = $("#userPage");
            const userTbody = $("#userTbody");
            // ç§»é™¤tr
            userTbody.find('tr').remove();
            const data = {
                userName: $("#userName").val(),
                userSex: $("#userSex").val(),
                userAddress: $("#userAddress").val()
            };
            const url = userMsgQueryUrl + pageNumber;
            $.post(url, data, (result) => {
                console.log(result);
                if (result.code == 0) {
                    const userData = result.resultData.users;
                    const users = userData.list;
                    for (let [index, user] of users.entries()) {
                        const tr = $(`<tr></tr>`);
                        tr.append(`<td>${parseInt(userData.startRow + index)}</td>`);
                        tr.append(
                            `<td ><a href=${JSON.stringify(user)} class="showUserModal" data-toggle="modal" data-target="#userMsgModal">${user.userName}</a></td>`
                        );
                        tr.append(`<td>${user.userPhone}</td>`);
                        tr.append($(`<td>` + (user.userState == 1 ?
                                `<div class="toggle-switch"><input name = "${users[index].userName}" href="${users[index].userId}" title = "${users[index].userState}" type="checkbox" class="toggle-switch__checkbox" checked><i class="toggle-switch__helper"></i></div>` :
                                `<div class="toggle-switch"><input name = "${users[index].userName}" href="${users[index].userId}" title = "${users[index].userState}" type="checkbox" class="toggle-switch__checkbox"><i class="toggle-switch__helper"></i></div>`
                        ) + `</td>`));
                        tr.append(`<td>${user.userAddress}</td>`);
                        userTbody.append(tr);
                    }
                    // ä¿®æ”¹ç”¨æˆ·çŠ¶æ€
                    $(".toggle-switch__checkbox").on('click', function () {
                        const userName = $(this).attr('name');
                        swal({
                            title: "ğŸ˜Š",
                            text: `ç¡®å®šè¦ä¿®æ”¹${userName}çš„çŠ¶æ€ä¹ˆ?`,
                            icon: "warning",
                            buttons: ["å–æ¶ˆ", "ç¡®å®š"],
                            dangerMode: false,
                        }).then((willUdate) => {
                            if (willUdate) {
                                const userId = $(this).attr("href");
                                let userState = $(this).attr("title");
                                userState = (userState == 1 ? 2 : 1);
                                const data = {
                                    userId,
                                    userState
                                }
                                console.log(data);
                                $.post(userMsgUpdateUrl, data);
                            } else {
                                swal(`ğŸ˜Š`, `${userName}çš„çŠ¶æ€æœªä¿®æ”¹`).then(() => {
                                    selectUsers(tempPageNumber);
                                });
                            }
                        })

                    });
                    // ç‚¹å‡»ç”¨æˆ·åå­—è§¦å‘å•å‡»äº‹ä»¶
                    $(".showUserModal").on('click', function () {
                        // è·å¾—JSONå½¢å¼å­—ç¬¦ä¸² è½¬æ¢æˆJSON
                        const jsonUser = JSON.parse($(this).attr('href'));
                        $(".modalName").text(jsonUser.userName);
                        $(".modalSex").text((jsonUser.userSex == 0 ? "â™‚" : "â™€"));
                        $(".modalEmail").text(jsonUser.userEmail);
                        $(".modalAddress").text(jsonUser.userAddress);
                        $(".modalDate").text(new Date(jsonUser.userDate).toLocaleString());
                    });
                    const pageData = result.resultData.users;
                    // åœ¨é¡µé¢ä¸­æ·»åŠ åˆ†é¡µæŒ‰é’®
                    showPageButton(userPageBody, pageData, selectUsers);
                } else {
                    const tr = $(`<tr><td colspan="5">æ²¡æœ‰æŸ¥è¯¢åˆ°æ»¡è¶³æ¡ä»¶çš„ä¿¡æ¯ï¼</td></tr>`);
                    userTbody.append(tr);
                }
            })
        }

    });
</script>
<script type="text/javascript">

</script>
</body>
</html>
